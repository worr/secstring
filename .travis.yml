language: go

go:
  - 1.2
  - tip

script:
  - go get code.google.com/p/go.tools/cmd/cover
  - go get github.com/hailiang/goveralls
  - go get code.google.com/p/go.tools/cmd/goimports
  - go get github.com/axw/gocov
  - go get code.google.com/p/gomock/gomock
  - go get github.com/qur/withmock
  - PATH=$PATH:$HOME/gopath/bin withmock go test -covermode=count -coverprofile="$(pwd)/profile.cov" secstring_mocks_test.go secstring.go
  - PATH=$PATH:$HOME/gopath/bin go test -covermode=count -coverprofile="$(pwd)/profile2.cov" secstring_test.go secstring.go
  - sed -i -e '/mode/d' profile2.cov
  - sed -i -e 's:command-line-arguments:github.com/worr/secstring:' profile.cov
  - sed -i -e 's:command-line-arguments:github.com/worr/secstring:' profile2.cov
  - cat profile2.cov >> profile.cov
  - $HOME/gopath/bin/goveralls -coverprofile=profile.cov -service=travis-ci
